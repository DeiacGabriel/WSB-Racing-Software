@page "/management/brands"
@using WSB_Management.Models
@using WSB_Management.Services
@using MudBlazor


<PageTitle>WSB-Sport - Marken</PageTitle>

<style>
    .brand-card { transition: all 0.2s; cursor: pointer; }
    .brand-card:hover { background-color: #e3f2fd !important; }
    .brand-card.selected { background-color: #bbdefb !important; border-left: 4px solid #1976d2; }
</style>

<div class="container-fluid p-3">
    @* Header *@
    <MudPaper Class="pa-3 mb-3" Elevation="2">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
            <div class="d-flex align-items-center gap-3">
                <MudIcon Icon="@Icons.Material.Filled.DirectionsBike" Size="Size.Large" Color="Color.Primary" />
                <div>
                    <MudText Typo="Typo.h5" Class="fw-bold">Marken Verwaltung</MudText>
                    <MudText Typo="Typo.body2" Color="Color.Secondary">
                        @Brands.Count Marken registriert
                    </MudText>
                </div>
            </div>
            
            <MudButton Variant="Variant.Filled" Color="Color.Success" StartIcon="@Icons.Material.Filled.Add"
                       OnClick="@AddNew">
                Neue Marke
            </MudButton>
        </div>
    </MudPaper>
    
    <div class="row">
        @* Liste *@
        <div class="@(SelectedBrand != null ? "col-12 col-md-6 col-lg-8" : "col-12")">
            <MudPaper Class="pa-0" Elevation="2">
                <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
                    <MudText Typo="Typo.h6">Markenliste</MudText>
                    <MudTextField T="string" @bind-Value="SearchText" Placeholder="Suchen..."
                                  Variant="Variant.Outlined" Margin="Margin.Dense" Style="width: 200px;"
                                  Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.Search"
                                  Immediate="true" />
                </div>
                
                <MudList T="Brand" Dense="true" Class="py-0">
                    @foreach (var brand in FilteredBrands)
                    {
                        var isSelected = SelectedBrand?.Id == brand.Id;
                        <MudListItem T="Brand" Class="@($"brand-card {(isSelected ? "selected" : "")}")"
                                     OnClick="@(() => Select(brand))">
                            <div class="d-flex justify-content-between align-items-center w-100">
                                <div class="d-flex align-items-center gap-2">
                                    <MudIcon Icon="@Icons.Material.Filled.DirectionsBike" Color="Color.Primary" />
                                    <MudText Typo="Typo.body1" Class="fw-bold">@brand.Name</MudText>
                                    <MudChip T="string" Size="Size.Small" Color="Color.Default">ID: @brand.Id</MudChip>
                                </div>
                                <span @onclick="@(() => Delete(brand.Id))" @onclick:stopPropagation="true">
                                    <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" Size="Size.Small" />
                                </span>
                            </div>
                        </MudListItem>
                        <MudDivider />
                    }
                </MudList>
                
                @if (!FilteredBrands.Any())
                {
                    <div class="text-center py-5 text-muted">
                        <MudIcon Icon="@Icons.Material.Filled.SearchOff" Size="Size.Large" />
                        <MudText>Keine Marken gefunden</MudText>
                    </div>
                }
            </MudPaper>
        </div>
        
        @* Detail Panel *@
        @if (SelectedBrand != null)
        {
            <div class="col-12 col-md-6 col-lg-4 mt-3 mt-md-0">
                <MudPaper Class="pa-4" Elevation="3" Style="border-left: 4px solid #1976d2;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <MudText Typo="Typo.h6">
                            @(IsNew ? "Neue Marke" : "Marke bearbeiten")
                        </MudText>
                        <MudIconButton Icon="@Icons.Material.Filled.Close" OnClick="@CloseDetail" />
                    </div>
                    
                    <MudTextField T="string" @bind-Value="SelectedBrand.Name" Label="Markenname"
                                  Variant="Variant.Outlined" Margin="Margin.Normal" FullWidth="true"
                                  Required="true" RequiredError="Name ist erforderlich" />
                    
                    <div class="d-flex gap-2 mt-4">
                        <MudButton Variant="Variant.Filled" Color="Color.Success" FullWidth="true"
                                   StartIcon="@Icons.Material.Filled.Save" OnClick="@Save">
                            Speichern
                        </MudButton>
                    </div>
                    
                    @if (!string.IsNullOrWhiteSpace(Message))
                    {
                        <MudAlert Severity="@(Message.Contains("Fehler") ? Severity.Error : Severity.Success)" 
                                  Class="mt-3" Dense="true">@Message</MudAlert>
                    }
                </MudPaper>
            </div>
        }
    </div>
</div>
